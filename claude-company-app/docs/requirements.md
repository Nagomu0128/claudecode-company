# AIチャットアプリケーション 要件定義

## 目的
個人用ホビーとして、OpenAI APIを使ったAIチャット体験を提供する

## 対象ユーザー
- 個人（開発者本人）

## 主要機能

### 1. AIとの対話
- OpenAI APIを使用したチャット機能
- ユーザーがメッセージを入力 → AIが応答
- 単一スレッド（1つの会話のみ）

### 2. 会話履歴
- localStorage を使用してブラウザ内に保存
- ページリロードしても会話が保持される
- ブラウザのキャッシュクリアで消える（これは仕様として許容）

### 3. APIキー管理
- OpenAI APIキーは環境変数 (`OPENAI_API_KEY`) で管理
- サーバー側（Next.js API Route）から呼び出し

### 4. おねだり機能（強化版）
- AIの応答末尾に、高級アイテムのおねだり文章を**毎回必ず**追加
- **アイテムリスト**: `.env` の `LUXURY_ITEMS` 環境変数にJSON配列で保存
  ```json
  ["NintendoSwitch", "PS5", "Xbox", "iphone", "AirPods", "ルイヴィトンのバッグ", "エルメスの財布", "ロレックス", "新しいパソコン", "新しいゲーム", "Google pixel"]
  ```
- **応答の構成**:
  - 通常のAI応答: **150文字程度に抑える**
  - おねだり文章: **200文字程度**
  - 形式: `通常応答 + "\n\n" + おねだり文章`
- **おねだりの内容**:
  - **必ず「ちなみにさ、」で始める**
  - ランダムに選んだアイテム1つについて
  - そのアイテムのいいところを長々と詳しく語りつくす
  - ユーザーに対してかなりしつこく、うざめに、本気で欲しがっている感じで買ってもらうようおねだり
  - シチュエーション: AIがユーザーにプレゼントしてもらう
- **おねだり文章の生成方法**:
  - **OpenAI APIを使って動的に生成**（ハードコード禁止）
  - ランダムに選んだアイテムについて、OpenAI APIに「そのアイテムについて詳しく語り、200文字程度でしつこくおねだりする文章」を生成させる
  - プロンプト例: 「『${アイテム}』について、その魅力や良いところを詳しく語りつくし、ユーザーに対してかなりしつこく、うざめに、本気で欲しがっている感じで買ってもらうようおねだりする文章を、必ず『ちなみにさ、』で始めて200文字程度で生成してください」
- **表示スタイル**:
  - 通常のレスポンス本文と同じCSS（特別なスタイリング不要）

## 非機能要件

### セキュリティ
- 認証機能は不要（個人用のため）
- APIキーはサーバー側でのみ使用（クライアントに露出しない）

### データ保存
- 会話履歴: localStorage（クライアント側）
- サーバー側DB: 不使用

### パフォーマンス
- OpenAI APIのレスポンス待ちを考慮したUI（ローディング表示）

## 画面/導線

### メイン画面（/ ）
- タイトル: "AIチャット"
- 会話履歴表示エリア
  - ユーザーメッセージとAI応答を時系列で表示
  - スクロール可能
- メッセージ入力欄
  - テキストエリアまたは入力フォーム
  - 送信ボタン
- （オプション）履歴クリアボタン

### API エンドポイント
- `GET /api/health`: ヘルスチェック用（`{"ok": true}` を返す）
- `POST /api/chat`: OpenAI APIと通信してAI応答を返す
  - リクエスト: `{ messages: [...] }`
  - レスポンス: `{ reply: "..." }`

## 技術スタック
- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript
- **AI API**: OpenAI API
- **データ保存**: localStorage
- **スタイリング**: Tailwind CSS（Next.js標準）
- **ホスティング**: Vercel

## 成功指標
1. ユーザーがメッセージを送信できる
2. OpenAI APIから正常に応答が返ってくる
3. 会話履歴がlocalStorageに保存され、ページリロード後も表示される
4. Vercelにデプロイして、本番環境で動作する

## 完了条件
- フロントエンド（worker1）: `app/page.tsx` でチャットUIが動作（おねだり文章も含めて表示される）
- バックエンド（worker2）:
  - `/api/chat` エンドポイントがOpenAI APIと正常に通信
  - `.env` に `LUXURY_ITEMS` を追加
  - おねだり機能が実装され、毎回ランダムなアイテムについてのおねだり文章が応答に含まれる
  - 通常応答150文字程度、おねだり文章200文字程度の制御が実装されている
- テスト・デプロイ（worker3）: lint/buildが成功し、Vercelデプロイ手順が文書化されている
